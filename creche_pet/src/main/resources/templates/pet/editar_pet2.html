<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro Pet - Formulário 2</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="../static/css/style.css" rel="stylesheet">
	
</head>

<body>
	
	<div th:insert="~{layout/header}"></div>

            <!-- Conteúdo principal -->
            <main>
				<div th:replace="layout/mensagens :: mensagens"></div>
				
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Editar Cadastro do Pet</h2>
					<a th:href="@{/exibir_pet}" class="btn btn-success">Exibir Pet</a>
                </div>
				
				

                <!--formulário -->
				
				<form th:action="@{/editar_pet2}" th:object="${tutor}" method="post" id="cadastroForm" class="needs-validation" novalidate>

			
				  <!-- Dados do Tutor -->
				
				  <div class="card border-secondary mb-4">
				    <div class="card-header bg-secondary text-white fw-bold">Dados do Tutor</div>
				    <div class="card-body row g-3">
				      <div class="col-md-4">
				        <label for="nome_tutor" class="form-label">Nome</label>
				        <input type="text" class="form-control" id="nome" th:field="*{nome}" maxlength="20" required>
				        <div class="invalid-feedback">Informe o nome.</div>
				      </div>
				      <div class="col-md-8">
				        <label for="sobrenome" class="form-label">Sobrenome</label>
				        <input type="text" class="form-control" id="sobrenome" th:field="*{sobrenome}" maxlength="100" required>
				        <div class="invalid-feedback">Informe o sobrenome.</div>
				      </div>
				      <div class="col-md-4">
				        <label for="cpf" class="form-label">CPF</label>
				        <input type="text" class="form-control" id="cpf" th:field="*{cpf}"  maxlength="14" required onblur="checkCPF()" >
					<div class="invalid-feedback">CPF inválido.</div>
				      </div>
				      <div class="col-md-4">
				        <label for="rg" class="form-label">RG</label>
				        <input type="text" class="form-control" id="rg" th:field="*{rg}" required>
				        <div class="invalid-feedback">Informe o RG.</div>
				      </div>
				      <div class="col-md-4">
				        <label for="telefone" class="form-label">Telefone</label>
				        <input type="text" class="form-control" id="telefone" th:field="*{telefone}" required>
				        <div class="invalid-feedback">Informe o telefone.</div>
				      </div>
				      <div class="col-md-8">
				        <label for="email" class="form-label">E-mail</label>
				        <input type="email" class="form-control" id="email" th:field="*{email}" placeholder="exemplo@gmail.com" required>
				        <div class="invalid-feedback">Informe o E-mail</div>
				      </div>
				    </div>
				  </div>

				 
				  <div class="d-flex justify-content-between">
				    <a th:href="@{/editar_pet}" class="btn btn-secondary">Voltar</a> <!-- ou a rota anterior -->
				    <button type="submit" class="btn btn-warning">Próxima Página</button>
				  </div>
				  
				  <div class="text-center mt-4">
				  	  <p class="fw-bold fim">2/3</p>
				   </div>



				</form>
				
				
				
				<!-- Fim Formulario-->
				
            </main>




			<div th:insert="~{layout/footer}"></div>
			
			

            <!-- Bootstrap e JavaScript -->
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>


            <!-- Inputmask JavaScript puro -->
            <script src="https://unpkg.com/inputmask@5.0.8/dist/inputmask.min.js"></script>
			

            <script>
                // Aplicar máscaras com JavaScript puro
                window.addEventListener('DOMContentLoaded', () => {
                    Inputmask("999.999.999-99").mask(document.getElementById("cpf"));
                    Inputmask("99.999.999-*").mask(document.getElementById("rg"));
                    Inputmask("(99) 99999-9999").mask(document.getElementById("telefone"));
                    Inputmask("99999-999").mask(document.getElementById("cep"));
                    Inputmask("decimal", {
                        radixPoint: ",",
                        groupSeparator: ".",
                        autoGroup: true,
                        digits: 3,
                        rightAlign: false
                    }).mask(document.getElementById("peso"));
                });
            </script>

            <script>
                // Validação Bootstrap 5 ao submeter
                (function () {
                    const form = document.getElementById('cadastroForm');
                    form.addEventListener('submit', function (event) {
                        if (!form.checkValidity()) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                })();
            </script>

            <script>
                document.getElementById('cep').addEventListener('blur', function () {
                    const cep = this.value.replace(/\D/g, '');

                    if (cep.length !== 8) return;

                    fetch(`https://viacep.com.br/ws/${cep}/json/`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.erro) {
                                alert('CEP não encontrado.');
                                return;
                            }

                            // Preencher os campos
                            document.getElementById('logradouro').value = data.logradouro || '';
                            document.getElementById('bairro').value = data.bairro || '';
                            document.getElementById('cidade').value = data.localidade || '';
                            document.getElementById('estado').value = data.uf || '';
                        })
                        .catch(() => {
                            alert('Erro ao buscar o CEP. Tente novamente.');
                        });
                });
            </script>
			<script>
				/* ---- VALIDAÇÃO DE CPF ---- */
				function validarCPF(cpf) {
				    cpf = cpf.replace(/\D/g, '');

				    if (cpf.length !== 11) return false;
				    if (/^(.)\1+$/.test(cpf)) return false;

				    let soma = 0, resto;

				    for (let i = 1; i <= 9; i++)
				        soma += parseInt(cpf[i - 1]) * (11 - i);
				    resto = (soma * 10) % 11;
				    if (resto === 10 || resto === 11) resto = 0;
				    if (resto !== parseInt(cpf[9])) return false;

				    soma = 0;
				    for (let i = 1; i <= 10; i++)
				        soma += parseInt(cpf[i - 1]) * (12 - i);
				    resto = (soma * 10) % 11;
				    if (resto === 10 || resto === 11) resto = 0;

				    return resto === parseInt(cpf[10]);
				}

				/* ---- VERIFICAÇÃO VISUAL DO CPF ---- */
				function checkCPF() {
				    const cpfInput = document.getElementById("cpf");

				    if (validarCPF(cpfInput.value)) {
				        cpfInput.classList.remove("is-invalid");
				        cpfInput.classList.add("is-valid");
				    } else {
				        cpfInput.classList.remove("is-valid");
				        cpfInput.classList.add("is-invalid");
				    }
				}

				/* ---- BLOQUEAR ENVIO SE CPF FOR INVÁLIDO ---- */
				document.getElementById("cadastroForm").addEventListener("submit", function(event) {
				    const cpfInput = document.getElementById("cpf");

				    if (!validarCPF(cpfInput.value)) {
				        cpfInput.classList.add("is-invalid");
				        event.preventDefault();
				        event.stopPropagation();
				    }

				    this.classList.add("was-validated");
				});
				</script>




</body>

</html>

<style>
   html,
   body {
     height: 100%;
     margin: 0;
     padding: 0;
   }

   body {
     display: flex;
     flex-direction: column;
     padding-top: 140px;
     padding-bottom: 70px;
     background-color: #ffffff;
   }

   header {
     z-index: 1000;
   }

   main {
     flex: 1;
     background-color: #f4f6f8;
     padding: 2rem 1rem;
     width: 100%;
	 padding-bottom: 70px;
   }

   /* Centraliza o conteúdo do main */
   main > * {
     max-width: 960px;
     margin-left: auto;
     margin-right: auto;
    
   }


   footer {

     position: fixed;
     bottom: 0;
     left: 0;
     right: 0;
   }

   /* Estilo de links do menu */
   .nav-link {
     transition: background-color 0.2s, color 0.2s;
   }

   .nav-link:hover {
     background-color: #e0e0e0;
 
     color: #000;
     border-radius: 4px;
   }
 </style>