<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Painel Administrativo - Lar dos Pets</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="../css/exibir.css" rel="stylesheet">
  
  

 
</head>

	<body>
	  <div th:insert="~{layout/header}"></div>

	  <main >
		<div th:replace="layout/mensagens :: mensagens"></div>
		
	    <div class="d-flex justify-content-between align-items-center mb-4">
	      <h2>Pets</h2>
	      <a th:href="@{/cadastrar_pet}" class="btn btn-success">Novo Cadastro</a>
	    </div>

	    <!-- Campo de pesquisa -->
	    <div class="mb-4">
	      <input type="text" class="form-control " placeholder="Pesquisar por nome do pet..." id="searchInput" onkeyup="searchTable()" />
	    </div>

	    <!-- Tabela din√¢mica -->
		<div th:unless="${#lists.isEmpty(pets)}">
	    <div class="table-responsive">
	      <table class="table table-bordered table-hover" id="petsTable">
	        <thead class="table-light">
	          <tr>
	            <th>Nome do Pet</th>
	            <th>Respons√°vel</th>
	            <th>A√ß√µes</th>
	          </tr>
	        </thead>
	        <tbody>         			

	          <tr th:each="pet: ${pets}">
	            <td th:text="${pet.nome}">Nome</td>
	            <td th:text="${pet.tutor.nome}">Tutor</td>
	            <td>
					<button type="button" class="btn btn-sm btn-info" data-bs-toggle="modal" th:data-bs-target="'#petModal__' + ${pet.idPet}">Ver Detalhes</button>

                  <a th:href="@{/cadastrar_pet_novo/{id}(id=${pet.tutor.idTutor})}" class="btn btn-sm btn-warning">Cadastrar Novo Pet</a>

					</td>
	            </td>
	          </tr>
	        </tbody>
	      </table>
	    </div>
	  </main>

	  <!-- MODAL DIN√ÇMICO -->
	  <div th:each="pet: ${pets}">
	    <div class="modal fade" th:id="'petModal__' + ${pet.idPet}" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
	      <div class="modal-dialog modal-lg">
	        <div class="modal-content">
	          <div class="modal-header bg-info text-white">
	            <h5 class="modal-title" th:text="'Detalhes do Pet: ' + ${pet.nome}"></h5>
	            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
	          </div>

	          <div class="modal-body">
	            <h5>üêæ Dados do Pet </h5>
	            <p><strong>Nome:</strong> <span th:text="${pet.nome}">Nome</span></p>
	            <p><strong>Esp√©cie:</strong> <span th:text="${pet.especie}">Esp√©cie</span></p>
	            <p><strong>Ra√ßa:</strong> <span th:text="${pet.raca}">Ra√ßa</span></p>
	            <p><strong>Data de Nascimento:</strong> <span th:text="${#dates.format(pet.dataNascimento, 'dd/MM/yyyy')}">Data</span></p>
	            <p><strong>Peso:</strong> <span th:text="${pet.peso}">Peso</span> kg</p>
	            <p><strong>Observa√ß√µes:</strong> <span th:text="${pet.observacoes}">Obs</span></p>

	            <hr>

	            <h5>üë§ Dados do Tutor </h5>
	            <p><strong>Nome:</strong> <span th:text="${pet.tutor.nome}"></span></p>
	            <p><strong>Sobrenome:</strong> <span th:text="${pet.tutor.sobrenome}"></span></p>
	            <p><strong>CPF:</strong> <span th:text="${pet.tutor.cpf}"></span></p>
	            <p><strong>RG:</strong> <span th:text="${pet.tutor.rg}"></span></p>
	            <p><strong>Telefone:</strong> <span th:text="${pet.tutor.telefone}"></span></p>
	            <p><strong>Email:</strong> <span th:text="${pet.tutor.email}"></span></p>

	            <hr>

	            <h5>üè† Endere√ßo </h5>
	            <p><strong>CEP:</strong> <span th:text="${pet.tutor.endereco.cep}"></span></p>
	            <p><strong>Logradouro:</strong> <span th:text="${pet.tutor.endereco.logradouro}"></span></p>
	            <p><strong>N√∫mero:</strong> <span th:text="${pet.tutor.endereco.numero}"></span></p>
	            <p><strong>Bairro:</strong> <span th:text="${pet.tutor.endereco.bairro}"></span></p>
	            <p><strong>Cidade:</strong> <span th:text="${pet.tutor.endereco.cidade}"></span></p>
	            <p><strong>Estado:</strong> <span th:text="${pet.tutor.endereco.estado}"></span></p>
	            <p><strong>Complemento:</strong> <span th:text="${pet.tutor.endereco.complemento}"></span></p>
	          </div>

	          <div class="modal-footer">
	         <!--
			--> 
			 <a th:href="@{/editar/{id}(id=${pet.idPet})}" class="btn btn-primary">Editar</a>
			<!--<a th:href="@{/excluir/{id}(id=${pet.idPet})}" class="btn btn-danger">Excluir</a>  -->
			<a href="#"  class="btn btn-danger"  th:onclick="'confirmarExclusao(\'/excluir/' + ${pet.idPet} + '\')'"> Excluir</a>
			
		

			<script>
			  // Seleciona todos os links com a classe btn-excluir
			  document.querySelectorAll('.btn-excluir').forEach(function(link) {
			    link.addEventListener('click', function(event) {
			      // Pergunta a confirma√ß√£o
			      if (!confirm('Tem certeza que deseja excluir este pet?')) {
			        event.preventDefault(); // cancela a navega√ß√£o se cancelar
			      }
			    });
			  });
			</script>


			
 

	            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
	          </div>
	        </div>
	      </div>
	    </div>
	  </div>


 

  <div th:insert="~{layout/footer}"></div>

  <!-- Bootstrap e JavaScript -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  


  <!-- Script de busca -->
  <script>
    function searchTable() {
      const input = document.getElementById("searchInput").value.toLowerCase();
      const rows = document.querySelectorAll("#petsTable tbody tr");

      rows.forEach(row => {
        const petNome = row.cells[0].textContent.toLowerCase();
        row.style.display = petNome.includes(input) ? "" : "none";
      });
    }
  </script>
  
 
  <script>
      function confirmarExclusao(url) {
        if (confirm("Tem certeza que deseja excluir este Pet? Esta a√ß√£o n√£o pode ser desfeita.")) {
          window.location.href = url;
        }
      }
    </script>


</body>
</html>

