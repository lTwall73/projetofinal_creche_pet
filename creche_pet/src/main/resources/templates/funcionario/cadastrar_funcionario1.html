<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro Funcionário - Formulário 1</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
	
</head>

<body>
	
	<div th:insert="~{layout/header}"></div>

            <!-- Conteúdo principal -->
            <main>
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Cadastro do Funcionário</h2>
                    <a th:href="@{/exibir_pet}" class="btn btn-success">Exibir Funcionários</a>
                </div>
				
				

                <!--formulário -->
				
				<form th:action="@{/cadastrar_funcionario1}" th:object="${funcionario}" method="post" id="cadastroForm" class="needs-validation" novalidate>

					<!-- Dados do Funcionário -->
					<div class="card border-secondary mb-4">
					  <div class="card-header bg-secondary text-white fw-bold">Dados do Funcionário</div>
					  <div class="card-body row g-3">

					    <div class="col-md-6">
					      <label for="nome" class="form-label">Nome</label>
					      <input type="text" class="form-control" id="nome" th:field="*{nome}" maxlength="20" required>
					      <div class="invalid-feedback">Informe o nome do funcionário.</div>
					    </div>

					    <div class="col-md-6">
					      <label for="sobrenome" class="form-label">Sobrenome</label>
					      <input type="text" class="form-control" id="sobrenome" th:field="*{sobrenome}" maxlength="50" required>
					      <div class="invalid-feedback">Informe o sobrenome.</div>
					    </div>

					    <div class="col-md-6">
					      <label for="cpf" class="form-label">CPF</label>
						  <input type="text" class="form-control" id="cpf" th:field="*{cpf}" maxlength="14" required onblur="checkCPF()">
						  <div class="invalid-feedback">CPF inválido.</div>
					    </div>

					    <div class="col-md-6">
					      <label for="rg" class="form-label">RG</label>
					      <input type="text" class="form-control" id="rg" th:field="*{rg}"  required>
					      <div class="invalid-feedback">Informe o RG.</div>
					    </div>

					    <div class="col-md-6">
					      <label for="telefone" class="form-label">Telefone</label>
					      <input type="text" class="form-control" id="telefone" th:field="*{telefone}" maxlength="20" required>
					      <div class="invalid-feedback">Informe o telefone.</div>
					    </div>

					    <div class="col-md-6">
					      <label for="email" class="form-label">Email</label>
					      <input type="email" class="form-control" id="email" th:field="*{email}" maxlength="80" required>
					      <div class="invalid-feedback">Informe o email.</div>
					    </div>

					    <div class="col-md-4">
					      <label for="data_nascimento" class="form-label">Data de Nascimento</label>
					      <input type="date" class="form-control" id="data_nascimento" th:field="*{dataNascimento}" required>
					      <div class="invalid-feedback">Informe a data de nascimento.</div>
					    </div>

					    <div class="col-md-4">
					      <label for="data_admissao" class="form-label">Data de Admissão</label>
					      <input type="date" class="form-control" id="data_admissao" th:field="*{dataAdmissao}" required>
					      <div class="invalid-feedback">Informe a data de admissão.</div>
					    </div>

					    <div class="col-md-4">
					      <label for="data_demissao" class="form-label">Data de Demissão</label>
					      <input type="date" class="form-control" id="data_demissao" th:field="*{dataDemissao}">
						  <div class="invalid-feedback">A demissão não pode ser antes da admissão.</div>
					  </div>
					 </div>
					</div>
					
					<div class="d-grid gap-2 d-md-flex justify-content-md-end">
						<button type="submit" class="btn btn-warning text-dark fw-bold">Próxima Página</button>
					 </div>

						<div class="text-center mt-4">
						   <p class="fw-bold fim">1/3</p>
						 </div>
	
				</form>
				

			
	
            </main>


			<div th:insert="~{layout/footer}"></div>
			
			

            <!-- Bootstrap e JavaScript -->
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>


            <!-- Inputmask JavaScript puro -->
            <script src="https://unpkg.com/inputmask@5.0.8/dist/inputmask.min.js"></script>
			

            <script>
                // Aplicar máscaras com JavaScript puro
                window.addEventListener('DOMContentLoaded', () => {
                    Inputmask("999.999.999-99").mask(document.getElementById("cpf"));
                    Inputmask("99.999.999-*").mask(document.getElementById("rg"));
                    Inputmask("(99) 99999-9999").mask(document.getElementById("telefone"));
                    Inputmask("99999-999").mask(document.getElementById("cep"));
                    Inputmask("decimal", {
                        radixPoint: ",",
                        groupSeparator: ".",
                        autoGroup: true,
                        digits: 3,
                        rightAlign: false
                    }).mask(document.getElementById("peso"));
                });
            </script>

            <script>
                // Validação Bootstrap 5 ao submeter
                (function () {
                    const form = document.getElementById('cadastroForm');
                    form.addEventListener('submit', function (event) {
                        if (!form.checkValidity()) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                })();
            </script>

            <script>
                document.getElementById('cep').addEventListener('blur', function () {
                    const cep = this.value.replace(/\D/g, '');

                    if (cep.length !== 8) return;

                    fetch(`https://viacep.com.br/ws/${cep}/json/`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.erro) {
                                alert('CEP não encontrado.');
                                return;
                            }

                            // Preencher os campos
                            document.getElementById('logradouro').value = data.logradouro || '';
                            document.getElementById('bairro').value = data.bairro || '';
                            document.getElementById('cidade').value = data.localidade || '';
                            document.getElementById('estado').value = data.uf || '';
                        })
                        .catch(() => {
                            alert('Erro ao buscar o CEP. Tente novamente.');
                        });
                });
            </script>
			
			<script>
			/* ---- VALIDAÇÃO DE CPF ---- */
			function validarCPF(cpf) {
			    cpf = cpf.replace(/\D/g, '');

			    if (cpf.length !== 11) return false;
			    if (/^(.)\1+$/.test(cpf)) return false;

			    let soma = 0, resto;

			    for (let i = 1; i <= 9; i++)
			        soma += parseInt(cpf[i - 1]) * (11 - i);
			    resto = (soma * 10) % 11;
			    if (resto === 10 || resto === 11) resto = 0;
			    if (resto !== parseInt(cpf[9])) return false;

			    soma = 0;
			    for (let i = 1; i <= 10; i++)
			        soma += parseInt(cpf[i - 1]) * (12 - i);
			    resto = (soma * 10) % 11;
			    if (resto === 10 || resto === 11) resto = 0;

			    return resto === parseInt(cpf[10]);
			}

			/* ---- VERIFICAÇÃO VISUAL DO CPF ---- */
			function checkCPF() {
			    const cpfInput = document.getElementById("cpf");

			    if (validarCPF(cpfInput.value)) {
			        cpfInput.classList.remove("is-invalid");
			        cpfInput.classList.add("is-valid");
			    } else {
			        cpfInput.classList.remove("is-valid");
			        cpfInput.classList.add("is-invalid");
			    }
			}

			/* ---- BLOQUEAR ENVIO SE CPF FOR INVÁLIDO ---- */
			document.getElementById("cadastroForm").addEventListener("submit", function(event) {
			    const cpfInput = document.getElementById("cpf");

			    if (!validarCPF(cpfInput.value)) {
			        cpfInput.classList.add("is-invalid");
			        event.preventDefault();
			        event.stopPropagation();
			    }

			    this.classList.add("was-validated");
			});
			</script>
			
			
			
			<script>
			    // Define a data máxima para hoje nos três campos
			    window.addEventListener('DOMContentLoaded', () => {
			        const today = new Date().toISOString().split('T')[0]; // "YYYY-MM-DD"

			        const camposData = [
			            'data_nascimento',
			            'data_admissao',
			            'data_demissao'
			        ];

			        camposData.forEach(id => {
			            const campo = document.getElementById(id);
			            if (campo) {
			                campo.setAttribute('max', today);
			            }
			        });
			    });
			</script>
			<script>
			      document.addEventListener("DOMContentLoaded", () => {
			          const admissao = document.getElementById("data_admissao");
			          const demissao = document.getElementById("data_demissao");

			          function validarDatas() {
			              if (demissao.value && admissao.value && demissao.value < admissao.value) {
			                  demissao.classList.add("is-invalid");
			                  demissao.setCustomValidity("A data de demissão não pode ser anterior à admissão.");
			              } else {
			                  demissao.classList.remove("is-invalid");
			                  demissao.setCustomValidity("");
			              }
			          }

			          admissao.addEventListener("change", validarDatas);
			          demissao.addEventListener("change", validarDatas);

			          document.getElementById("cadastroForm").addEventListener("submit", function (event) {
			              validarDatas();
			              if (!this.checkValidity()) {
			                  event.preventDefault();
			                  event.stopPropagation();
			              }
			          });
			      });
			  </script>

			




</body>

</html>

<style>
   html,
   body {
     height: 100%;
     margin: 0;
     padding: 0;
   }

   body {
     display: flex;
     flex-direction: column;
     padding-top: 140px;
     padding-bottom: 70px;
     background-color: #ffffff;
   }

   header {
     z-index: 1000;
   }

   main {
     flex: 1;
     background-color: #f4f6f8;
     padding: 2rem 1rem;
     width: 100%;
   }

   /* Centraliza o conteúdo do main */
   main > * {
     max-width: 960px;
     margin-left: auto;
     margin-right: auto;
    
   }


   footer {

     position: fixed;
     bottom: 0;
     left: 0;
     right: 0;
   }

   /* Estilo de links do menu */
   .nav-link {
     transition: background-color 0.2s, color 0.2s;
   }

   .nav-link:hover {
     background-color: #e0e0e0;
 
     color: #000;
     border-radius: 4px;
   }
   
   .fim{
	padding-bottom: 30px;
   }
 </style>